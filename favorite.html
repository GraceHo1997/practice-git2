<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Jekyll v3.8.5">

  <title>我的最愛 ｜ 美容服務整合平台</title>

  <!-- Bootstrap core CSS -->
  <link href="statics/css/bootstrap.min.css" rel="stylesheet">
  <link href="statics/css/font-awesome.min.css" rel="stylesheet">
  <link href="statics/icon/favicon.ico" type="image/x-icon" rel="icon">
  <link href="statics/icon/favicon.ico" type="image/x-icon" rel="shortcut icon">


  <style>
  html,body{
    font-family: 微軟正黑體;
	  color: #39393e;
   }
   
   .menu {
	  font-size: 16px;
	  line-height: 1;
	  display: flex;
	  justify-content: center;
	  align-items: center;
	}
	
	.menu__list {
	  font-size: 16px;
	  position: relative;
	  display: -webkit-flex;
	  display: flex;
	  -webkit-flex-wrap: wrap;
	  flex-wrap: wrap;
	  margin: 0;
	  padding: 0;
	  list-style: none;
	}
	
	.menu__item {
	  font-size: 16px;
	  display: block;
	  margin: 1em 0;
	}
	
	.menu__login {
	  font-size: 16px;
	  display: block;
	  margin: 1em 0;
	  text-align:right;
	}
	
	.menu__link {
	  font-size: 1.05em;
	  font-weight: bold;
	  display: block;
	  padding: 1em;
	  cursor: pointer;
	  -webkit-user-select: none;
	  -moz-user-select: none;
	  -ms-user-select: none;
	  user-select: none;
	  -webkit-touch-callout: none;
	  -khtml-user-select: none;
	  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	}
	.menu__link:hover,
	.menu__link:focus {
		outline: none;
	}
	.menu--prospero .menu__link {
		position: relative;
		display: block;
		margin: 0 1.5em;
		padding: 0.75em 0;
		text-align: center;
		color: #b5b5b5;
		transition: color 0.3s;
	}
	.menu--prospero .menu__link:hover,
	.menu--prospero .menu__link:focus {
		color: #929292;
	}
	
	.menu--prospero .menu__item--current .menu__link {
		color: #d94f5c;
	}
	.menu--prospero .menu__link::before {
		content: '';
		position: absolute;
		left: 0;
		bottom: 0;
		width: 100%;
		height: 4px;
		background: #d94f5c;
		transform: scale3d(0, 1, 1);
		transition: transform 0.1s;
	}
	.menu--prospero .menu__item--current .menu__link::before {
		transform: scale3d(1, 1, 1);
		transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
		transition-duration: 0.3s;
	}
	
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
    
    h1 {
	  font-size: 34px;
	  color: #39393e;
	  font-weight: bold;
	  letter-spacing: 2px;
	}

  </style>
  <!-- Custom styles for this template -->
  <link href="statics/css/product.css" rel="stylesheet">
  <link href="statics/css/jquery-confirm.css" rel="stylesheet">

  <script src="statics/js/jquery-3.4.1.min.js"></script>
  <script src="statics/js/jquery-confirm.js"></script>
</head>

<body>
  <section class="section section--menu" id="Prospero">
	  <nav class="menu menu--prospero">
	
	    <ul class="menu__list">
	      <li class="menu__item">
	        <a class="menu__link" href="home.html" style="text-decoration:none;">首頁</a>
	      </li>
	      <li class="menu__item">
	        <a class="menu__link" href="service.html" style="text-decoration:none;">選擇服務</a>
	      </li>
	      <li class="menu__item">
	        <a class="menu__link" href="reserve.html" style="text-decoration:none;">檢視預約</a>
	      </li>
	      <li class="menu__item">
	        <a class="menu__link" href="rating.html" style="text-decoration:none;">檢視評價</a>
	      </li>
	      <li class="menu__item menu__item--current">
	        <a class="menu__link" href="favorite.html" style="text-decoration:none;">我的最愛</a>
	      </li>
	      <li class="menu__item">
	        <a class="menu__link" href="index.html" style="text-decoration:none;">登出</a>
	      </li>
	    </ul>
	    
	  </nav>
	</section>    
	<center>
    <br><h1>我的最愛</h1>
    <p class="lead">★☆★☆★</p>
	</center>
	        <h4 class="mb-3 ml-3" style="font-weight:600;color:#d94f5c">服務資訊</h4>
	        <hr class="mb-4">
	        <div class="row">
				    <div class="table-responsive">
			        <table id="fav_table" class="table table-striped table-sm">
			          <thead>
			            <tr>
			              <th class="text-center" style="width: 10%"></th>
			              <th class="text-center" style="width: 30%">服務名稱</th>
			              <th class="text-center" style="width: 15%">單價</th>
			              <th class="text-center" style="width: 10%">說明</th>
			              <th class="text-center" style="width: 15%">刪除</th>
			              <th class="text-center" style="width: 10%"></th>
			            </tr>
			          </thead>
			          <tbody>
			          </tbody>
			        </table>
			      </div>
		      </div>
	

  <script>   
  
  $(document).ready(function() {
  	$(".menu__item").click('.menu__link',function(e){
  	    $(".menu__item").removeClass("menu__item--current");
  	    $(this).addClass("menu__item--current");
  	  })  
  });
  
    var [client_fav_obj]  = getFavDataFromClient();
    
    if (client_fav_obj.length == 0) {
    	alert("我的最愛清單裡沒有任何服務！");
    	calcSummaryInformation();
    }
    else
    	getFavService();
   
    function cleanAllData() {
    	client_fav_obj = [];
      updateFavDataToClent();
      $("#fav_table > tbody").empty();
    }
    
    function getFavService() {
      $.ajax({
        type: "GET",
        url: "api/service.do",
        crossDomain: true,
        cache: false,
        data: "id_list=" + client_fav_obj.toString(),
        dataType: 'json',
        timeout: 5000,
        success: function (response) {
          if (response.status == 200) {
        	  updateFavTable(response.response.data);
        	  keyEventListen();
        	  calcSummaryInformation();
          }
        },
        error: function () {
          alert("無法連線到伺服器！");
        }
      });
    }
    
    function updateAllQuantitySubtotal() {
    	for (var i=0 ; i < client_fav_obj.length ; i++) {
    		var id = client_fav_obj[i];
    		var price = $('#price_' + id).html();
    	}
    }
    
    
    function keyEventListen() {
    	
    	
    	$('button[name="remove[]"').click(function () {
    		var id = (this.id).split('_')[1];
    		var i = client_fav_obj.indexOf(id);
    		
    		if (i > -1) {
	    		client_fav_obj.splice(i, 1)
    		}
    		
    		updateFavDataToClent();
    		$('#row_' + id).remove();
    		if (client_fav_obj.length == 0)
  		      alert("我的最愛清單裡沒有任何服務！！");
    		calcSummaryInformation();
    	});
    	
    	
    }
    
    
    
    function updateFavTable(data) {
    	table_html = '';
    	$("#fav_table > tbody").empty();
        $.each(data, function(index, value) {
        	table_html += '<tr id="row_' + value.id + '">';
        	table_html += '<td class="align-middle text-center"><p class="text-break">'+ "" + '</p></td>';
        	table_html += '<td class="align-middle text-center"><p class="text-break">'+ value.name + '</p><img class="align-middle" src="statics/img/service/' + value.image + '" width="50%">';
        	table_html += '<td class="align-middle text-center"><p class="text-break">'+"$"+ value.price +'</p></td>';
        	table_html += '<td class="align-middle text-center">'+value.describe +'</td>';
        	table_html += '<td class="align-middle text-center"><button id="remove_' + value.id + '" name="remove[]" type="button" class="btn btn-danger">移除</button></td>';
        	table_html += '<td class="align-middle text-center"><p class="text-break">'+ "" + '</p></td>';
        	table_html += '</tr>';
        })

      $("#fav_table > tbody").append(table_html);
    }
    
    function getFavDataFromClient() {
    	let fav = JSON.parse(localStorage.getItem("client_fav_obj"));
    	let amount = JSON.parse(localStorage.getItem("client_fav_amount"));
    	fav = !fav ? new Array() : fav;
    	return [fav];
    }
    
    function updateFavDataToClent() {
    	localStorage.setItem("client_fav_obj", JSON.stringify(client_fav_obj));
    }
    
    function calcSummaryInformation() {
    	var total_item = client_fav_obj.length;
    	
    	for(var i=0 ; i < total_item ; i++) {
    		var id = client_fav_obj[i];
    	}
    }
    
    function setButtonState(id, action) {
      if (!action) {
          $('#' + id).prop('disabled', true);
          $('#' + id).addClass('disabled');
          $('#' + id).html('請先新增商品');
      }
      else {
    	  $('#' + id).prop('disabled', false);
        $('#' + id).removeClass('disabled');
      }
    }
  </script>

  <footer class="text-muted">
    <div class="container">
      <p class="float-right">
        <a href="#">Back to top</a>
      </p>
    </div>
  </footer>
</body>

</html>
